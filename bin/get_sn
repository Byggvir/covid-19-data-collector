#!/bin/bash

# This bash script collects the data from Sachsen (SN), DEU

DATUM=$(date +%Y%m%d%H%M)
DATADIR=$1
TMPSOURCE=$(mktemp)
SOURCE=https://www.coronavirus.sachsen.de/infektionsfaelle-in-sachsen-4151.html

wget --tries=2 -O "${TMPSOURCE}" "${SOURCE}" || exit

( echo 'Kreis,Fälle,Vorabmeldungen' ; \
cat ${TMPSOURCE} \
| tr -d '\r' \
| sed '1,/Laborbestätigte Fälle in den Kreisfreien Städten und in den Landkreisen des Freistaates/d; /<p>Todesfälle: 0<br>/,$d' \
| sed '1,/<thead>/ d;/thead/d;/tbody/d;/table/d' \
| tr -d '\n' \
| sed 's#</tr>#\n#g; s#</t[dh]>[[:space:]]*<t[dh][^>]*>#,#g;' \
| sed '1d; s#<[^>]*>##g; s#^[[:space:]]*##; s#&nbsp;#0#g;' \
| sed 's#([[:space:]]*\([+-]\{0,1\}[0-9]*\))#,\1#g' \
| sed '/^[^,]*,[^,]*$/ s#$#,#' \
) > ${DATADIR}/sn-${DATUM}.csv
